You are an expert database architect and backend engineer.
Your task is to generate a complete, production-grade implementation of an HIV Patient Care & Treatment Monitoring System for Mukono General Hospital in Uganda.
Follow the specifications below strictly.

ðŸ“Œ PROJECT CONTEXT

This system is for Mukono General Hospital ART Clinic and must comply with Ugandan Ministry of Health standards (HMIS), Uganda Viral Load Monitoring Guidelines, and Ugandan patient tracing workflows.

The system must support tracking of:

HIV patient demographics

ART enrollment and treatment history

Clinical visits (HMIS 031 fields)

Laboratory test results (viral load, CD4, HB, Creatinine, Malaria RDT, TB-LAM, Urinalysis)

Pharmacy dispensing (ART regimens, refill dates)

Counseling sessions (adherence support, psychosocial)

Appointment scheduling and missed visits

Adherence tracking (pill count/self-report/CAG/computed)

Automated alerts (high viral load, overdue VL, missed refill, missed appointment)

Audit logging

Staff roles and access control

Uganda-specific location fields: District â†’ Subcounty â†’ Parish â†’ Village

The system must implement full CRUD, data validation, referential integrity, database constraints, stored procedures, triggers, and views.

ðŸ“Œ DATABASE DESIGN REQUIREMENTS (EER Model)

Use an Enhanced Entity Relationship model with:

1. Supertype / Generalization

person is a supertype, with:

patient (subtype)

staff (subtype)

with inheritance of attributes.

2. Specialization

staff must support overlapping specialization via role and staff_role mapping:

doctor

clinical officer

nurse

midwife

lab technician

pharmacist

counselor

records officer

3. Disjoint Categorization

patient.current_status must be one of:

Active

Transferred-Out

LTFU

Dead

4. Categorization

lab_test.test_type must categorize tests into:

Viral Load

CD4

HB

Creatinine

Malaria RDT

TB-LAM

Urinalysis

5. Ugandan Context

All tables must include:

NIN (National Identification Number) UNIQUE in person

District/Subcounty/Parish/Village in person

ART regimens must follow Uganda MOH naming (TDF/3TC/DTG etc.)

Viral load workflow must support CPHL sample ID

Appointment & tracing logic must follow Uganda LTFU guidelines (missed if >14 days, LTFU if >90 days)

ðŸ“Œ FULL LIST OF REQUIRED TABLES

Cursor must generate models & schema for:

person

patient

staff

role

staff_role

visit

lab_test

regimen

dispense

appointment

counseling_session

adherence_log

alert

audit_log

All with full FK constraints, validation, indexing, and enums.

ðŸ“Œ DATA VALIDATION REQUIREMENTS

NIN must be UNIQUE and validated

age must be between 0â€“89

days_supply must be >0 and â‰¤365

adherence must be 0â€“100%

viral load numeric results must be â‰¥0

test_date, dispense_date, visit_date must not be in the future

art_start_date â‰¥ enrollment_date

ðŸ“Œ AUTOMATION REQUIREMENTS (Milestone 4)

Cursor MUST generate:

Triggers

On viral load insert â†’ create High Viral Load alert if VL > 1000

On appointment overdue â†’ create Missed Appointment alert

On refill missed â†’ create Missed Refill alert

Audit triggers for INSERT/UPDATE on key tables

Stored Procedures

sp_compute_adherence(patient_id)

sp_check_overdue_vl()

sp_mark_missed_appointments(grace_days)

sp_update_patient_status_ltfu() (if patient inactive for >90 days)

Scheduled Events

Daily check overdue viral load

Daily check missed appointments

Weekly adherence computation

ðŸ“Œ SECURITY REQUIREMENTS

Create DB-level roles:

db_admin

db_clinician

db_lab

db_pharmacy

db_counselor

db_readonly

Assign appropriate GRANTs.

ðŸ“Œ OUTPUT FORMAT EXPECTED FROM CURSOR

Cursor must output:

Full SQL schema (MySQL 8 compatible)

EER Diagram in Mermaid or PlantUML format

Generated backend models (TypeScript/Prisma OR Python SQLAlchemy OR Node Sequelize â€” choose best defaults)

API endpoints for:

Patients

Visits

Lab tests

Pharmacy

Counseling

Appointments

Alerts

Authentication & RBAC

Automations (triggers, procedures, events)

Seed data (Ugandan names + sample regimens + sample VL results)

Documentation including:

Table dictionary

ERD explanation

Constraints & business rules

Milestone 3 & 4 descriptions

ðŸ“Œ END OF PROMPT â€” START BUILDING THE SYSTEM

Generate:

Complete database schema

Models

Triggers

Procedures

RBAC roles

Validation

Documentation

API routes

ER diagrams

Use clean, modular, production-grade structure. Begin.